==============
AT Commands Introduction
==============
This article introduces the Bouffalo Labs AT command set and usage. The command set includes: basic AT commands, Wi-Fi function AT commands, TCP/IP toolbox AT commands, and BLE related AT commands.


.. table:: Command Types

    +------------+---------------+------------------------------------------+
    |  Type      | Format        | Description                              |
    +============+===============+==========================================+
    | Read       | AT+<x>?       | Get current value of command parameters  |
    +------------+---------------+------------------------------------------+
    | Set        | AT+<x>=<···>  | Set value of command parameters          |
    +------------+---------------+------------------------------------------+
    | Execute    | AT+<x>        | Execute a command                        |
    +------------+---------------+------------------------------------------+

==================
Basic AT Commands
==================

Overview
=================
.. table:: Command List

    +----------------------+------------------------------------------+
    |  Command             | Description                              |
    +======================+==========================================+
    | `AT+UART`_           | Set UART configuration                   |
    +----------------------+------------------------------------------+
    | `AT+GMR`_            | View version information                 |
    +----------------------+------------------------------------------+
    | `AT+S.HELP`_         | View AT help                             |
    +----------------------+------------------------------------------+
    | `AT+RST`_            | Restart the module                       |
    +----------------------+------------------------------------------+
    | `AT+RESTORE`_        | Reset                                    |
    +----------------------+------------------------------------------+
    | `AT+GSLP`_           | Enter deep-sleep                         |
    +----------------------+------------------------------------------+

Description
===================
AT+UART
---------

    +----------+--------------------------------------------------------------------+------------------------------------------------------------------+
    | Commands | Query Command                                                      | Set Command                                                      |
    +          +                                                                    +                                                                  +
    |          | AT+UART?                                                           | AT+UART=<baudrate>,<databits>,<stopbits>,<parity>,<flow control> |
    +----------+--------------------------------------------------------------------+------------------------------------------------------------------+
    | Response | +UART_CUR:<baudrate>,<databits>,<stopbits>,<parity>,<flow control> | OK                                                               |
    +          +                                                                    +                                                                  +
    |          | OK                                                                 |                                                                  |
    +----------+--------------------------------------------------------------------+------------------------------------------------------------------+
    |Parameters| - <baudrate>: UART baud rate                                                                                                          |
    +          +                                                                                                                                       +
    |          | - <databits>: number of data bits                                                                                                     |
    +          +                                                                                                                                       +
    |          |   * 5: 5-bit                                                                                                                          |
    +          +                                                                                                                                       +
    |          |   * 6: 6-bit                                                                                                                          |
    +          +                                                                                                                                       +
    |          |   * 7: 7-bit                                                                                                                          |
    +          +                                                                                                                                       +
    |          |   * 8: 8-bit                                                                                                                          |
    +          +                                                                                                                                       +
    |          | - <stopbits>: number of stop bits                                                                                                     |
    +          +                                                                                                                                       +
    |          |   * 1: 1-bit                                                                                                                          |
    +          +                                                                                                                                       +
    |          |   * 2: 1.5-bit                                                                                                                        |
    +          +                                                                                                                                       +
    |          |   * 3: 2-bit                                                                                                                          |
    +          +                                                                                                                                       +
    |          | - <parity>:                                                                                                                           |
    +          +                                                                                                                                       +
    |          |   * 0: None                                                                                                                           |
    +          +                                                                                                                                       +
    |          |   * 1: Odd                                                                                                                            |
    +          +                                                                                                                                       +
    |          |   * 2: Even                                                                                                                           |
    +          +                                                                                                                                       +
    |          | - <flow control>:                                                                                                                     |
    +          +                                                                                                                                       +
    |          |   * 0: Disabled                                                                                                                       |
    +          +                                                                                                                                       +
    |          |   * 1: Enable RTS                                                                                                                     |
    +          +                                                                                                                                       +
    |          |   * 2: Enable CTS                                                                                                                     |
    +          +                                                                                                                                       +
    |          |   * 3: Enable RTS & CTS                                                                                                               |
    +----------+---------------------------------------------------------------------------------------------------------------------------------------+

AT+GMR
----------

    +----------------------+-----------------------------------------------------------------+
    | Command              | AT+GMR                                                          |
    +----------------------+-----------------------------------------------------------------+
    | Response             | <AT version info>                                               |
    +                      +                                                                 +
    |                      | <SDK version info>                                              |
    +                      +                                                                 +
    |                      | <compile time>                                                  |
    +                      +                                                                 +
    |                      | OK                                                              |
    +----------------------+-----------------------------------------------------------------+


AT+RST
---------

    +----------------------+--------------+
    |  Command             | AT+RST       |
    +----------------------+--------------+
    | Response             | OK           |
    +----------------------+--------------+

AT+RESTORE
------------

    +----------------------+--------------+
    |  Command             | AT+RESTORE   |
    +----------------------+--------------+
    | Response             | OK           |
    +----------------------+--------------+

AT+S.HELP
------------

    +----------------------+--------------+
    |  Command             | AT+S.HELP    |
    +----------------------+--------------+
    | Response             | OK           |
    +----------------------+--------------+

AT+GSLP
-----------

    +----------+-------------------------------------------------------------------------------+
    |  Command |  AT+GSLP=<time>                                                               |
    +----------+-------------------------------------------------------------------------------+
    | Response | <time>                                                                        |
    +          +                                                                               +
    |          | OK                                                                            |
    +----------+-------------------------------------------------------------------------------+
    |Parameters| - <time>: Sleep duration in seconds. BL602 will wake up after time has elapsed|
    +----------+-------------------------------------------------------------------------------+

====================
Wi-Fi 功能 AT 指令
====================
.. table:: 指令列表

    +------------------+------------------------------------------+
    |  指令            | 描述                                     |
    +------------------+------------------------------------------+
    | `AT+CWMODE`_     | 设置 Wi-Fi 模式 (STA/AP/STA+AP)          |
    +------------------+------------------------------------------+
    | `AT+CWLAP`_      | 扫描附近AP                               |
    +------------------+------------------------------------------+
    | `AT+CWJAP`_      | 连接AP                                   |
    +------------------+------------------------------------------+
    | `AT+CWQAP`_      | 断开AP                                   |
    +------------------+------------------------------------------+
    | `AT+CWAUTOCONN`_ | 设置自动重连                             |
    +------------------+------------------------------------------+
    | `AT+SOFTAP`_     | 开启AP                                   |
    +------------------+------------------------------------------+

基础AT指令描述
===================
AT+CWMODE
------------

    +----------+-----------------------------+----------------------------------------------------------------------+
    |  指令    | 查询指令                    | 设置指令                                                             |
    +          +                             +                                                                      +
    |          | AT+CWMODE?                  | AT+CWMODE=<mode>                                                     |
    +          +                             +                                                                      +
    |          | 功能：查询BL602 Wi-Fi 模式  | 功能：设置BL602 Wi-Fi 模式                                           |
    +----------+-----------------------------+----------------------------------------------------------------------+
    | 响应     | +CWMODE:<mode>              | OK                                                                   |
    +----------+-----------------------------+----------------------------------------------------------------------+
    | 参数说明 | - <mode>:                                                                                          |
    +          +                                                                                                    +
    |          |    * 0: 无 Wi-Fi 模式，并且关闭 Wi-Fi RF                                                           |
    +          +                                                                                                    +
    |          |    * 1: Station 模式                                                                               |
    +          +                                                                                                    +
    |          |    * 2: SoftAP 模式                                                                                |
    +          +                                                                                                    +
    |          |    * 3: SoftAP+Station 模式                                                                        |
    +----------+----------------------------------------------------------------------------------------------------+

AT+CWLAP
----------

    +----------+-------------------------------------------------------------------------------------------------+
    |  指令    | 查询指令                                                                                        |
    +          +                                                                                                 +
    |          | AT+CWLAP                                                                                        |
    +          +                                                                                                 +
    |          | 功能：扫描附近的AP热点。                                                                        |
    +----------+-------------------------------------------------------------------------------------------------+
    | 响应     | +CWLAP:                                                                                         |
    +          +                                                                                                 +
    |          | <ap list>...                                                                                    |
    +          +                                                                                                 +
    |          | OK                                                                                              |
    +----------+-------------------------------------------------------------------------------------------------+
    | 响应说明 | - <序号>,<SSID>,<BSSID>,<信道>,<信号强度>,<加密方式>                                            |
    +----------+-------------------------------------------------------------------------------------------------+


AT+CWAUTOCONN
----------------

    +----------+-------------------------------+--------------------------------------------------------------------+
    |  指令    | 查询指令                      | 设置指令                                                           |
    +          +                               +                                                                    +
    |          | AT+CWAUTOCONN?                | AT+CWAUTOCONN=<auto_connect>                                       |
    +          +                               +                                                                    +
    |          | 功能：查询BL602 Wi-Fi 自动重连| 功能：设置BL602 Wi-Fi 自动重连                                     |
    +----------+-------------------------------+--------------------------------------------------------------------+
    | 响应     | +CWAUTOCONN:<mode>            | OK                                                                 |
    +----------+-------------------------------+--------------------------------------------------------------------+
    | 参数说明 | - <auto_connect>:                                                                                  |
    +          +                                                                                                    +
    |          |    * 0: 当WiFi模式变成Station或SoftAP+Station时，不连接WiFi                                        |
    +          +                                                                                                    +
    |          |    * 1: 当WiFi模式变成Station或SoftAP+Station(默认配置)时，连接WiFi                                |
    +----------+----------------------------------------------------------------------------------------------------+


AT+CWJAP
----------

    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
    |  指令    | 查询指令                                                                                 | 设置指令                                                                                    |
    +          +                                                                                          +                                                                                             +
    |          | AT+CWJAP?                                                                                | AT+CWJAP=<ssid>,<pwd>                                                                       |
    +          +                                                                                          +                                                                                             +
    |          | 功能：查询 BL602 Station 已连接的 AP 信息。                                              | 功能：设置 BL602 Station 需连接的 AP。                                                      |
    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
    | 响应     | +CWJAP:<ssid>,<ip>                                                                       | OK                                                                                          |
    +          +                                                                                          +                                                                                             +
    |          | OK                                                                                       | +EVT:0:wifi connected                                                                       |
    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
    | 参数说明 | - <ssid>: 字符串串参数，AP 的 SSID                                                       | - <ssid>: 目标 AP 的 SSID                                                                   |
    +          +                                                                                          +                                                                                             +
    |          |                                                                                          | - <pwd>: 目标 AP 的 密码                                                                    |
    +          +                                                                                          +                                                                                             +
    |          | - <ip>: 当前获取到的ip地址                                                               |   * 若SSID或密码包含任何特殊字符，例如"或者\，则需要转义                                    |
    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+

AT+CWQAP
-----------

    +----------+-----------------------------------------------------------------------------+
    |  指令    |  设置指令：                                                                 |
    +          +                                                                             +
    |          |  AT+CWQAP=<link id>                                                         |
    +----------+-----------------------------------------------------------------------------+
    | 响应     | OK                                                                          |
    +----------+-----------------------------------------------------------------------------+

AT+SOFTAP
----------

    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
    |  指令    | 查询指令                                                                                 | 设置指令                                                                                    |
    +          +                                                                                          +                                                                                             +
    |          | AT+SOFTAP?                                                                               | AT+SOFTAP=<ssid>,[pwd]                                                                      |
    +          +                                                                                          +                                                                                             +
    |          | 功能：查看开启的AP热点信息。                                                             | 功能：开启一个AP热点。                                                                      |
    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
    | 响应     | +SOFTAP:<ip>,<bssid>                                                                     | OK                                                                                          |
    +          +                                                                                          +                                                                                             +
    |          | OK                                                                                       |                                                                                             |
    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+
    | 参数说明 | - <ip>: 开启的AP热点的IP地址                                                             | - <ssid>: 设置AP 的 SSID                                                                    |
    +          +                                                                                          +                                                                                             +
    |          |                                                                                          | - [pwd]: 设置 AP 的 密码，若没有此参数，则该AP为开放式AP                                    |
    +          +                                                                                          +                                                                                             +
    |          | - <bssid>: 当前开启的AP热点的MAC地址                                                     |   * 若SSID或密码包含任何特殊字符，例如"或者\，则需要转义                                    |
    +----------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+


====================
TCP/IP 相关 AT 指令
====================
.. table:: 指令列表

    +-----------------+------------------------------------------+
    |  指令           | 描述                                     |
    +-----------------+------------------------------------------+
    | `AT+CIPSTART`_  | 建立 TCP 连接，UDP 传输                  |
    +-----------------+------------------------------------------+
    | `AT+CIPCLOSE`_  | 关闭 TCP 连接，UDP 传输                  |
    +-----------------+------------------------------------------+
    | `AT+CIPSERVER`_ | 删除或创建TCP服务器                      |
    +-----------------+------------------------------------------+
    | `AT+CIPSEND`_   | 发送TCP/IP数据                           |
    +-----------------+------------------------------------------+
    | `+IPD`_         | 收到TCP/IP数据                           |
    +-----------------+------------------------------------------+

基础AT指令描述
===================
AT+CIPSTART
-------------------
.. table:: 建立 TCP/UDP 连接

    +----------+-----------------------------------------------------------------------------------------------------------------------------------------------+
    | 设置指令 |  AT+CIPSTART=<link id>,<type>,<remote IP>,<remote port>                                                                                       |
    +----------+-----------------------------------------------------------------------------------------------------------------------------------------------+
    | 响应     | OK                                                                                                                                            |
    +          +                                                                                                                                               +
    |          | 或者已经建立TCP连接,响应:ALREADY CONNECTTED ERROR                                                                                             |
    +----------+-----------------------------------------------------------------------------------------------------------------------------------------------+
    |参数说明  | - <link id>: 需要设置的连接ID                                                                                                                 |
    +          +                                                                                                                                               +
    |          | - <type>: 字符串串参数，连接类型，"TCP"，"UDP"                                                                                                |
    +          +                                                                                                                                               +
    |          | - <remote IP>: 字符串串参数，远端 IP 地址                                                                                                     |
    +          +                                                                                                                                               +
    |          | - <remote port>: 远端端口号                                                                                                                   |
    +----------+-----------------------------------------------------------------------------------------------------------------------------------------------+
    | 示例     | AT+CIPSTART=0,TCP,192.168.101,8000                                                                                                            |
    +          +                                                                                                                                               +
    |          | AT+CIPSTART=1,UDP,192.168.101,5000                                                                                                            |
    +----------+-----------------------------------------------------------------------------------------------------------------------------------------------+

AT+CIPCLOSE
-----------------

    +----------+------------------------------------------------------------------+
    |  指令    |  设置指令：                                                      |
    +          +                                                                  +
    |          |  AT+CIPCLOSE=<link id>                                           |
    +----------+------------------------------------------------------------------+
    | 响应     | OK                                                               |
    +----------+------------------------------------------------------------------+
    | 参数说明 | - <link id>: 需要关闭的ID                                        |
    +----------+------------------------------------------------------------------+

AT+CIPSERVER
----------------

    +----------+------------------------------------------------------------------+
    |  指令    |  设置指令：                                                      |
    +          +                                                                  +
    |          |  AT+CIPSERVER=<mode>[,<port>]                                    |
    +----------+------------------------------------------------------------------+
    | 响应     | OK                                                               |
    +----------+------------------------------------------------------------------+
    | 参数说明 | - <mode>:                                                        |
    +          +                                                                  +
    |          |    * 0: 关闭服务器器                                             |
    +          +                                                                  +
    |          |    * 1: 建立服务器器                                             |
    +          +                                                                  +
    |          | - <port>: 端口号，默认为 333                                     |
    +          +                                                                  +
    +----------+------------------------------------------------------------------+
    | 示例     | // 建立 TCP 服务器器                                             |
    +          +                                                                  +
    |          |    AT+CIPSERVER=1,80                                             |
    +          +                                                                  +
    +----------+------------------------------------------------------------------+

AT+CIPSEND
----------------

    +----------+------------------------------------------------------------------+
    |  指令    |  设置指令：                                                      |
    +          +                                                                  +
    |          |  AT+CIPSEND=<link id>,<data len>                                 |
    +----------+------------------------------------------------------------------+
    | 响应     | OK                                                               |
    +----------+------------------------------------------------------------------+
    | 参数说明 | - <link id>:    连接ID                                           |
    +          +                                                                  +
    |          | - <data len>: 需要传输的数据长度（单位：byte）                   |
    +          +                                                                  +
    +----------+------------------------------------------------------------------+
    | 示例     |   AT+CIPSEND=0,20                                                |
    +          +                                                                  +
    |          |    表示即将向id为0的连接发送20字节的数据                         |
    +          +                                                                  +
    +----------+------------------------------------------------------------------+

+IPD
----------------

    +----------+------------------------------------------------------------------+
    | 说明     | +IPD为收到TCP/UDP对端连接数据时的响应                            |
    +          +                                                                  +
    |          | +IPD:<link id>,<data len>                                        |
    +          +                                                                  +
    |          | <data>                                                           |
    +----------+------------------------------------------------------------------+
    |参数说明  | - <link id>:发送数据的ID                                         |
    +          +                                                                  +
    |          | - <data len>:即将接收的数据长度（单位：byte）                    |
    +          +                                                                  +
    |          | - <data>:接收数据                                                |
    +----------+------------------------------------------------------------------+


====================
BLE 相关 AT 指令
====================
.. table:: 指令列表

    +------------------+------------------------------------------+
    |  指令            | 描述                                     |
    +------------------+------------------------------------------+
    | `AT+BLEDATALEN`_ | 设置 BLE 数据包⻓度                      |
    +------------------+------------------------------------------+
    | `AT+BLENAME`_    | 设置 BLE 设备名称                        |
    +------------------+------------------------------------------+
    | `AT+BLEADDR`_    | 设置 BLE 设备地址                        |
    +------------------+------------------------------------------+

基础AT指令描述
===================
AT+BLEDATALEN
---------------------

    +----------+------------------------------------------------------------------+
    |  指令    |  设置指令：                                                      |
    +          +                                                                  +
    |          |  AT+BLEDATALEN=<conn_index>,<pkt_data_len>                       |
    +          +                                                                  +
    |          |  功能：设置 BLE 数据包⻓度。                                     |
    +----------+------------------------------------------------------------------+
    | 响应     | OK                                                               |
    +----------+------------------------------------------------------------------+
    | 参数说明 | - <conn_index>: BLE 连接号, 范围 [0~2].                          |
    +          +                                                                  +
    |          | - <pkt_data_len>: 数据包长度，取值范围: 0x001b ~ 0x00fb          |
    +----------+------------------------------------------------------------------+
    | 注意     | - 需要先建立 BLE 连接，才能设置数据包长度                        |
    +----------+------------------------------------------------------------------+
    | 示例     | AT+BLEINIT=1   // 初始化为 client                                |
    +          +                                                                  +
    |          |   AT+BLECONN=0,"24:0a:c4:09:34:23"                               |
    +          +                                                                  +
    |          |  AT+BLEDATALEN=0,30                                              |
    +----------+------------------------------------------------------------------+

AT+BLENAME
----------------

    +----------+-----------------------------+----------------------------------------+
    |  指令    | 查询指令                    | 设置指令                               |
    +          +                             +                                        +
    |          | AT+BLENAME?                 | AT+BLENAME=<device_name>               |
    +          +                             +                                        +
    |          | 功能：查询 BLE 设备名称。   | 功能：设置 BLE 设备名称，最大长度为32  |
    +----------+-----------------------------+----------------------------------------+
    | 响应     | +BLENAME:<device_name>      | OK                                     |
    +          +                             +                                        +
    |          | OK                          |                                        |
    +----------+-----------------------------+----------------------------------------+
    | 参数说明 | - <device_name>: BLE 设备名称                                        |
    +----------+-----------------------------+----------------------------------------+

AT+BLEADDR
----------------

    +----------+------------------------------------------+----------------------------------------+
    |  指令    | 查询指令                                 | 设置指令                               |
    +          +                                          +                                        +
    |          | AT+BLEADDR?                              | AT+BLEADDR=<addr_type>[,<random_addr>] |
    +          +                                          +                                        +
    |          | 功能：查询 BLE 设备的 public address。   | 功能：设置 BLE 设备的地址。            |
    +----------+------------------------------------------+----------------------------------------+
    | 响应     | +BLEADDR:<BLE_public_addr>               | OK                                     |
    +          +                                          +                                        +
    |          | OK                                       |                                        |
    +----------+------------------------------------------+----------------------------------------+
    | 参数说明 | - <addr_type>:                                                                    |
    +          +                                                                                   +
    |          |    * 0: public address                                                            |
    +          +                                                                                   +
    |          |    * 1: random address                                                            |
    +----------+------------------------------------------+----------------------------------------+
